#!/usr/bin/env bash
# Quickly create a new issue

flags=(--repo mskelton/dotfiles)
cmd="$1"
shift

_print_help() {
	echo 'Usage: quick [command] [args]'
	echo ''
	echo 'Commands:'
	echo '  list'
	echo '  add [title]'
	echo '  close [issue number]'
	echo '  view [issue number]'
}

# Print help if no args are provided
if [[ -z "$cmd" || "$cmd" == 'help' ]]; then
	_print_help
	exit 0
fi

if [[ "$cmd" == 'list' ]]; then
	gh issue list "${flags[@]}"
elif [[ "$cmd" == 'add' ]]; then
	gh issue create "${flags[@]}" -a "@me" -t "$*" -b ''
elif [[ "$cmd" == 'close' ]]; then
	# Close all if 'all' is passed
	if [[ "$1" == 'all' ]]; then
		items=$(gh issue list "${flags[@]}" | awk '{print $1}')

		# Exit if no issues are found
		if [[ -z "$items" ]]; then
			echo 'No issues to close'
			exit 0
		fi

		# shellcheck disable=SC2086
		gh issue close "${flags[@]}" $items
		exit 0
	fi

	for num in "$@"; do
		gh issue close "${flags[@]}" "$num"
	done
elif [[ "$cmd" == 'view' ]]; then
	for num in "$@"; do
		gh issue view -w "${flags[@]}" "$num"
	done
else
	_print_help
	exit 1
fi
