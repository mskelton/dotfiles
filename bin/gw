#!/usr/bin/env bash
# Create a new worktree and open it in Cursor
# Usage: gw <branch_name>

# Check if a branch name is provided
if [ -z "$1" ]; then
	echo "Usage: gw <branch_name>"
	exit 1
fi

cd "$HOME/dev/web"

branch=ms/$1
dir="$HOME/dev/web-$1"

# Create a new worktree using --no-checkout for speed
git worktree add --no-checkout -b "$branch" "$dir"

# Reload Cursor to the new directory
cursor "$dir"

# Checkout the code (slow, but at this point Cursor won't get messed up)
git checkout "$branch"

# Reload direnv to install deps
cd "$dir"
direnv allow .
eval "$(direnv export bash)"

# Configure Graphite
gt track
